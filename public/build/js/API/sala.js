import{obtenerUrl,limpiarHtml}from"../utility/utilidades.js";import UI from"../layout/UI.js";!function(){let e;const o=document.querySelector("#contenido-sala");function a(){const{nombre:a,descripcion:n,alumnos:c,alumnosMax:s,profesores:r,profesoresMax:d,url:i,publico:l,acceso:m,password:p}=e;limpiarHtml(o);const u=document.querySelector(".nombre-pagina");u.textContent=a,u.ondblclick=()=>{!function(e){const{nombre:o}=e,a=document.createElement("FORM");a.classList.add("formulario","formulario-modal"),a.onsubmit=o=>{o.preventDefault(),function(e,o){const a=o.querySelector("#nombre").value.trim();if(""===a)return void UI.mostrarAlerta("La Descripcion es Obligatoria",o);e.nombre=a,t(e,"modal")}(e,o.target)};const n=document.createElement("DIV");n.classList.add("campo");const c=document.createElement("LABEL");c.textContent="Cambiar Nombre",c.setAttribute("for","nombre");const s=document.createElement("INPUT");s.placeholder="Actualizar Nombre de Sala",s.name="nombre",s.type="text",s.id="nombre",s.value=o,n.appendChild(c),n.appendChild(s);const r=document.createElement("INPUT");r.type="Submit",r.value="Guardar Cambios",r.classList.add("boton-verde-block"),a.appendChild(n),a.appendChild(r),UI.crearModal(a)}({...e})};const f=document.createElement("DIV");f.classList.add("descripcion","seccion-sala");const b=document.createElement("BUTTON");b.classList.add("boton-naranja-block"),b.textContent="Editar Descripcion",b.onclick=()=>{!function(e){const{nombre:o,descripcion:a}=e,n=document.createElement("FORM");n.classList.add("formulario","formulario-modal"),n.onsubmit=o=>{o.preventDefault(),function(e,o){const a=o.querySelector("#descripcion").value.trim();if(""===a)return void UI.mostrarAlerta("La Descripcion es Obligatoria",o);if(a.length<50)return void UI.mostrarAlerta("La Descripcion debe llevar al menos 50 Caracteres",o);e.descripcion=a,t(e,"modal")}(e,o.target)};const c=document.createElement("DIV");c.classList.add("campo");const s=document.createElement("LABEL");s.textContent="Descripcion de Sala "+o,s.setAttribute("for","descripcion");const r=document.createElement("TEXTAREA");r.placeholder="Actualizar Descripcion de Sala",r.name="descripcion",r.id="descripcion",r.value=a,c.appendChild(s),c.appendChild(r);const d=document.createElement("INPUT");d.type="Submit",d.value="Guardar Cambios",d.classList.add("boton-verde-block"),n.appendChild(c),n.appendChild(d),UI.crearModal(n)}({...e})},f.appendChild(UI.formatearDescripcion(n)),f.appendChild(b);const C=document.createElement("DIV");C.classList.add("alumnos","seccion-sala"),C.innerHTML=`\n            <h4>Alumnos: </h4>\n    \n            <div class="seccion-flex">\n                <p class="alumnos-contador">${c} de ${s}</p>\n            \n                <div class="opciones-hover">\n    \n                    <div class="tres-puntos"></div> \n    \n                    <div class="opciones">\n                        <a class="opcion" href="/sala/alumnos?url=${i}">Ver Alumnos</a>\n                        <button class="opcion" id="modificar-alumnos">Modificar Cantidad Alumnos</button>\n                    </div>\n                </div>\n            </div>\n        `,C.onclick=o=>{"modificar-alumnos"===o.target.id&&function(e){const{alumnosMax:o}=e,a=document.createElement("FORM");a.classList.add("formulario","formulario-modal"),a.onsubmit=o=>{o.preventDefault(),function(e,o){const{alumnos:a}=e,n=o.querySelector("#alumnosMax").value.trim();if(n>60||n<1||isNaN(n))return void UI.mostrarAlerta("Numero Invalido",o);if(n<a)return void UI.mostrarAlerta("Hay mas alumnos ya unidos",o);e.alumnosMax=n,t(e,"modal")}(e,o.target)};const n=document.createElement("DIV");n.classList.add("campo");const c=document.createElement("LABEL");c.textContent="Maximo de Alumnos",c.setAttribute("for","alumnosMax");const s=document.createElement("INPUT");s.placeholder="Actualizar Numero de Alumnos",s.type="number",s.name="alumnosMax",s.id="alumnosMax",s.value=o,s.min="1",s.max="60",n.appendChild(c),n.appendChild(s);const r=document.createElement("INPUT");r.type="Submit",r.value="Guardar Cambios",r.classList.add("boton-verde-block"),a.appendChild(n),a.appendChild(r),UI.crearModal(a)}({...e})};const h=document.createElement("DIV");h.classList.add("profesores","seccion-sala"),h.innerHTML=`\n            <h4>Profesores Colaboradores: </h4>\n    \n            <div class="seccion-flex">\n                <p>${"0"===d?"Sin Profesores Colaboradores":`${r} de ${d}`}</p>\n    \n                <div class="opciones-hover">\n    \n                    <div class="tres-puntos"></div> \n                    <div class="opciones" id="opciones-profesores">\n                        ${"0"!==d?`<a href="/sala/profesores?url=${i}" class="opcion">Ver Profesores</a>`:""}\n                        <button class="opcion" id="modificar-profesores">Modificar Cantidad Profesores</button>\n                    </div>\n                </div>\n            </div>\n        `,h.onclick=o=>{"modificar-profesores"===o.target.id&&function(e){const{profesoresMax:o}=e,a=document.createElement("FORM");a.classList.add("formulario","formulario-modal"),a.onsubmit=o=>{o.preventDefault(),function(e,o){const{profesores:a}=e,n=o.querySelector("#profesoresMax").value.trim();if(n>4||n<0||isNaN(n))return void UI.mostrarAlerta("Numero Invalido",o);if(n<a)return void UI.mostrarAlerta("hay mas profesores ya unidos",o);e.profesoresMax=n,t(e,"modal")}(e,o.target)};const n=document.createElement("DIV");n.classList.add("campo");const c=document.createElement("LABEL");c.textContent="Maximo de Maestros Colaboradores",c.setAttribute("for","profesoresMax");const s=document.createElement("INPUT");s.placeholder="Actualizar Numero de Profesores",s.type="number",s.name="profesoresMax",s.id="profesoresMax",s.value=o,s.min="0",s.max="4",n.appendChild(c),n.appendChild(s);const r=document.createElement("INPUT");r.type="Submit",r.value="Guardar Cambios",r.classList.add("boton-verde-block"),a.appendChild(n),a.appendChild(r),UI.crearModal(a)}({...e})};const v=document.createElement("DIV");v.classList.add("panel-sala");const E=document.createElement("DIV");E.classList.add("accion");const x=document.createElement("H4");x.textContent="Estatus: ";const I=document.createElement("BUTTON");I.className="1"===l?"boton-azul-block":"boton-naranja-block",I.textContent="1"===l?"Publico":"Privado",I.onclick=()=>{var o;(o={...e}).publico="1"===o.publico?"0":"1",o.password="",t(o,"token")},E.appendChild(x),E.appendChild(I);const L=document.createElement("DIV");L.classList.add("accion");const M=document.createElement("H4");M.textContent="Acceso a Alumnos: ";const A=document.createElement("BUTTON");A.className="1"===m?"boton-azul-block":"boton-naranja-block",A.textContent="1"===m?"Activado":"Desactivado",A.onclick=()=>{var o;(o={...e}).acceso="1"===o.acceso?"0":"1",t(o,"acceso")},L.appendChild(M),L.appendChild(A);const T=document.createElement("DIV");T.classList.add("accion");const U=document.createElement("H4");U.textContent="Administrar Tests: ";const k=document.createElement("A");if(k.className="boton-verde-block",k.textContent="Ver Tests",k.href="/sala/tests?url="+i,T.appendChild(U),T.appendChild(k),v.appendChild(E),v.appendChild(L),"0"===l){const o=document.createElement("DIV");o.classList.add("accion");const a=document.createElement("H4");a.textContent="Copiar Token de Acceso: ";const n=document.createElement("BUTTON");n.className="boton-verde-block",n.textContent="Copiar Token",n.onclick=()=>{!async function(){const{id:o,password:a}=e;try{const e=`${a}_${o}`;await navigator.clipboard.writeText(e),Swal.fire("Token Copiado","Se Ha Copiado a Tu Portapapeles","success")}catch(e){console.error(e)}}()},o.appendChild(a),o.appendChild(n);const c=document.createElement("DIV");c.classList.add("accion");const s=document.createElement("H4");s.textContent="Cambiar Token de Acceso: ";const r=document.createElement("P");r.textContent=function(e){const o=[...e];let a="";return o.forEach((e,o)=>{a+=o>=5?"*":e}),a}(p);const d=document.createElement("BUTTON");d.className="boton-azul-block",d.textContent="Cambiar Token",d.onclick=()=>{var o;(o={...e}).password="",t(o,"token")},c.appendChild(s),c.appendChild(r),c.appendChild(d),v.appendChild(o),v.appendChild(c)}v.appendChild(T),o.appendChild(f),o.appendChild(C),o.appendChild(h),o.appendChild(v)}async function t(o,t){const{id:n,nombre:c,url:s,descripcion:r,alumnos:d,profesores:i,alumnosMax:l,profesoresMax:m,password:p,creado:u,actualizado:f,publico:b,acceso:C,usuarioId:h}=o,v=new FormData;v.append("id",n),v.append("nombre",c),v.append("url",s),v.append("descripcion",r),v.append("alumnos",d),v.append("profesores",i),v.append("alumnosMax",l),v.append("profesoresMax",m),v.append("password",p),v.append("creado",u),v.append("actualizado",f),v.append("publico",b),v.append("acceso",C),v.append("usuarioId",h),v.append("tipoConsulta",t);try{const o=await fetch("/api/sala/actualizar",{method:"POST",body:v}),n=await o.json();"exito"===n.tipo&&(e=n.sala,a()),"exito"===n.tipo&&"modal"===t&&UI.cerrarModal()}catch(e){console.error(e)}}!async function(){const o="/api/sala?url="+obtenerUrl();try{const t=await fetch(o),n=await t.json();"exito"===n.tipo&&(e=n.sala,a())}catch(e){console.error(e)}}()}();