import Test from"./Test.js";import UI from"../../../layout/UI.js";export default class TestMedio extends Test{constructor(e={}){super(e)}calcularNumOpciones(){return this.opciones.reduce((e,t)=>e+t.opciones.length,0)}eliminarPregunta(e){this.preguntas=this.preguntas.filter(t=>parseInt(t.id)!==parseInt(e)),this.opciones=this.opciones.filter(t=>parseInt(t.id)!==parseInt(e))}eliminarOpcion(e){this.eliminarPregunta(e)}calcularMinimoYMaximo(){const e=this.opciones.map(({opciones:e})=>e.map(e=>parseInt(e.valor))),t=e.map(e=>Math.max(...e)).reduce((e,t)=>e+t,0);if(0===this.instrucciones.length){const n=e.map(e=>Math.min(...e));return{maximo:t,minimo:Math.min(...n)}}return{maximo:t}}mostrarModificarOpcion(e,t,n){const{id:o,opciones:a}=e,i=document.createElement("DIV"),r=document.createElement("FORM");r.classList.add("formulario","formulario-modal");const c=document.createElement("P");c.textContent=t,c.classList.add("pregunta-opcion"),r.appendChild(c);const l=document.createElement("BUTTON");l.type="button",l.textContent="Cambiar Numero de opciones",l.classList.add("boton-naranja"),l.onclick=n=>{this.mostrarCambiarNumInp(e,t)},n&&(e={id:o,opciones:[]}),this.mostrarInputsOpciones(r,n||a.length,e),r.appendChild(l),i.appendChild(r),UI.crearModal(i)}mostrarCambiarNumInp(e,t){const{opciones:n}=e,o=document.createElement("DIV"),a=document.createElement("FORM");a.classList.add("formulario","formulario-modal");const i=document.createElement("P");i.textContent=t,i.classList.add("pregunta-opcion"),a.appendChild(i);const r=document.createElement("DIV"),c=document.createElement("LABEL"),l=document.createElement("INPUT");r.classList.add("campo"),c.textContent="Numero de Opciones: ",c.setAttribute("for","num-opciones"),l.placeholder="Numero de Opciones Para Este Campo",l.type="number",l.id="num-opciones",l.name="num-opciones",l.min=2,l.max=10,l.value=n.length,r.appendChild(c),r.appendChild(l);const p=document.createElement("BUTTON");p.type="submit",p.classList.add("boton-naranja"),p.textContent="Cambiar";const s=document.createElement("BUTTON");s.type="button",s.classList.add("boton-rojo"),s.textContent="Cancelar",s.onclick=()=>{this.mostrarModificarOpcion(e,t)},a.onsubmit=n=>{n.preventDefault(),this.validarNumOpciones(a,l.value,e,t)},a.appendChild(r),a.appendChild(p),a.appendChild(s),o.appendChild(a),UI.crearModal(o)}mostrarModalOpciones(){const e=document.createElement("DIV"),{opciones:t,preguntas:n}=this,o=document.createElement("H2");o.textContent="Opciones: ";const a=document.createElement("DIV");if(a.classList.add("seccion","contenedor-opciones"),0===t.length){const e=document.createElement("P");e.textContent="No Hay Opciones",a.appendChild(e)}else t.forEach(e=>{const{id:t,opciones:o}=e,i=n.filter(e=>parseInt(e.id)===parseInt(t));if(1===i.length){const[{pregunta:n}]=i,r=document.createElement("DIV"),c=document.createElement("H4");c.textContent=n,r.appendChild(c),o.forEach(({opcion:e,valor:t},n)=>{const o=document.createElement("LI"),a=document.createElement("SPAN"),i=document.createElement("SPAN"),c=document.createElement("P");a.textContent=`Opcion ${n+1}: `,i.textContent=e,c.textContent="Valor: "+t,o.appendChild(a),o.appendChild(i),o.appendChild(c),r.appendChild(o)});const l=document.createElement("SPAN");l.classList.add("acciones"),l.innerHTML='\n                        <button type="button" class="boton-naranja" id="actualizar-opcion">Modificar</button>\n                        <button type="button" class="boton-rojo" id="eliminar-opcion">Eliminar</button>\n                    ',l.onclick=o=>{"actualizar-opcion"===o.target.id&&this.mostrarModificarOpcion({...e},n),"eliminar-opcion"===o.target.id&&this.mostrarEliminarOpcion(t)},r.appendChild(l),a.appendChild(r)}});e.appendChild(o),e.appendChild(a),UI.crearModal(e)}formulario2(e){const t=this.preguntas.length+1,n=document.createElement("DIV");n.classList.add("campo-pregunta-opcion","seccion");const o=document.createElement("DIV"),a=document.createElement("LABEL"),i=document.createElement("INPUT");o.classList.add("campo"),a.textContent=`Pregunta del Campo ${t}: `,a.setAttribute("for","pregunta"),i.placeholder="Pregunta del Campo",i.id="pregunta",i.name="pregunta",i.type="text",o.appendChild(a),o.appendChild(i);const r=document.createElement("DIV"),c=document.createElement("LABEL"),l=document.createElement("INPUT");r.classList.add("campo"),c.textContent="Numero de Opciones: ",c.setAttribute("for","num-opciones"),l.placeholder="Numero de Opciones Para Este Campo",l.type="number",l.id="num-opciones",l.name="num-opciones",l.min=2,l.max=10,l.oninput=e=>{this.validarNumOpciones(e.target.parentElement,e.target.value.trim())},r.appendChild(c),r.appendChild(l),n.appendChild(o),n.appendChild(r),e.appendChild(n)}mostrarInputsOpciones(e,t,n={}){const{id:o,opciones:a}=n,i=document.createElement("DIV");i.classList.add("campo-opciones","seccion");for(let e=1;e<=t;e++){let t,n;a&&a.length>=1&&(t=a[e-1].opcion,n=a[e-1].valor);const r=document.createElement("DIV"),c=document.createElement("LABEL"),l=document.createElement("INPUT");r.classList.add("campo"),c.setAttribute("for","opcion-"+e),c.textContent=`Opcion ${e}: `,l.type="text",l.name="opcion-"+e,l.id="opcion-"+e,l.classList.add(o?"opcion-input-modal":"opcion-input"),l.placeholder="Nueva Opcion",l.value=t??"",r.appendChild(c),r.appendChild(l);const p=document.createElement("DIV"),s=document.createElement("LABEL"),d=document.createElement("INPUT");p.classList.add("campo"),s.setAttribute("for","valor-"+e),s.textContent="Valor: ",d.name="valor-"+e,d.id="valor-"+e,d.placeholder="Valor de la Opcion",d.classList.add(o?"valor-input-modal":"valor-input"),d.type="number",d.min=1,d.max=10,d.value=n??"",p.appendChild(s),p.appendChild(d),i.appendChild(r),i.appendChild(p)}const r=document.createElement("BUTTON");r.type="button",r.textContent=o?"Guardar Cambios":"Agregar Campo",r.classList.add("boton-verde","agregar-campo"),r.onclick=e=>{this.validarCampo(e.target.parentElement,t,o)},e.onsubmit=e=>e.preventDefault(),e.appendChild(i),e.appendChild(r)}validarCampo(e,t,n){const o=e.querySelector(".campo #pregunta"),a=o?o.value.trim():"",i=e.querySelector(".campo #num-opciones"),r=e.querySelectorAll(n?".campo .opcion-input-modal":".campo .opcion-input"),c=e.querySelectorAll(n?".campo .valor-input-modal":".campo .valor-input");let l=[],p=[];if(r.forEach(e=>l=[...l,e.value.trim()]),c.forEach(e=>p=[...p,e.value.trim()]),!n){if(""===a)return void UI.mostrarAlerta("La Pregunta Es Obligatoria",e);if(parseInt(t)!==r.length||parseInt(t)!==c.length)return void UI.mostrarAlerta("Las Opciones NO Coinciden Con El Valor Dado",e)}const s=l.filter(e=>""===e),d=p.filter(e=>""===e||isNaN(e)||e>10||e<1);if(0!==s.length||0!==d.length)return void UI.mostrarAlerta("Todos los campos Son Obligatorios o Invalidos",e);const m=Date.now(),u={id:m,opciones:[]};for(let e=0;e<l.length;e++){const t=l[e],n=p[e],o={id:Date.now(),opcion:t,valor:n};u.opciones=[...u.opciones,o]}if(n)return u.id=n,this.modificarOpcion(u),this.mostrarModalOpciones(),this.cambiarPagina(2),this.validarMaximoInstrucciones(),void Swal.fire({title:"Exito",text:"Se Actualizo la Opcion",icon:"success"});const h={id:m,pregunta:a};this.agregarPregunta(h),this.agregarOpcion(u),o.previousElementSibling.textContent=`Pregunta del Campo ${this.preguntas.length+1}: `,o.value="",i.value="",r[0].parentElement.parentElement.remove(),e.parentElement.querySelector(".agregar-campo").remove()}validarNumOpciones(e,t,n,o){if(!n){const t=e.parentElement.querySelector(".campo-opciones"),n=e.parentElement.querySelector(".agregar-campo");t&&t.remove(),n&&n.remove()}if(""===t)return void UI.mostrarAlerta("El Numero Es Obligatorio",e);if(isNaN(t)||t>10||t<2)return void UI.mostrarAlerta("Solo Se Pueden Agregar de 2 a 10 Opciones",e);if(n)return void this.mostrarModificarOpcion(n,o,t);const a=e.querySelector(".alerta");a&&a.remove(),this.mostrarInputsOpciones(e.parentElement,t)}}