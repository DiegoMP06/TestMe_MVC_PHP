import UI from"../../../layout/UI.js";import{datos,mostrarFormulario}from"../../functions/tests/funcionesTestCrear.js";export default class Test{constructor(t={}){this.nombre=t.nombre??"",this.descripcion=t.descripcion??"",this.instrucciones=t.instrucciones??[],this.opciones=t.opciones??[],this.preguntas=t.preguntas??[],this.numOpciones=t.opciones??0,this.numPreguntas=t.numPreguntas??0,this.categoriaId=t.categoriaId??"",this.tipoTestId=t.tipoTestId??""}agregarPregunta(t){this.preguntas=[...this.preguntas,t]}modificarPregunta(t){this.preguntas=this.preguntas.map(e=>parseInt(e.id)===t.id?t:e)}eliminarPregunta(t){this.preguntas=this.preguntas.filter(e=>parseInt(e.id)!==parseInt(t))}agregarOpcion(t){this.opciones=[...this.opciones,t]}modificarOpcion(t){this.opciones=this.opciones.map(e=>parseInt(e.id)===parseInt(t.id)?t:e)}eliminarOpcion(t){this.opciones=this.opciones.filter(e=>parseInt(e.id)!==parseInt(t))}agregarInstruccion(t){this.instrucciones=[...this.instrucciones,t]}modificarInstruccion(t){this.instrucciones=this.instrucciones.map(e=>parseInt(e.id)===parseInt(t.id)?t:e)}eliminarInstruccion(){return this.instrucciones.pop()}cambiarPagina(t){datos.pagina=t,mostrarFormulario()}validarMaximoInstrucciones(){if(this.instrucciones.length>0){const t=this.calcularMinimoYMaximo().maximo;this.instrucciones=this.instrucciones.filter(e=>parseInt(e.maximo)<=t);const e=this.instrucciones[this.instrucciones.length-1];datos.minimo=parseInt(e.maximo)+1}}mostrarModificarinstruccion(t){const{titulo:e,instruccion:n,id:i,maximo:o,minimo:a}=t,r=document.createElement("DIV"),c=document.createElement("FORM");c.classList.add("formulario","formulario-modal");const s=document.createElement("DIV"),d=document.createElement("LABEL"),l=document.createElement("INPUT");s.classList.add("campo"),d.textContent="Titulo: ",d.setAttribute("for","titulo-modal"),l.placeholder="Titulo de Instruccion",l.type="text",l.id="titulo-modal",l.name="titulo-modal",l.classList.add("input"),l.value=e,s.appendChild(d),s.appendChild(l);const m=document.createElement("DIV"),u=document.createElement("LABEL"),p=document.createElement("TEXTAREA");m.classList.add("campo"),u.textContent="Contenido: ",u.setAttribute("for","instruccion-modal"),p.placeholder="Contenido de Instruccion",p.id="instruccion-modal",p.name="instruccion-modal",p.classList.add("input"),p.value=n,m.appendChild(u),m.appendChild(p);const h=document.createElement("BUTTON");h.type="submit",h.textContent="Guardar Cambios",h.classList.add("boton-verde"),c.appendChild(s),c.appendChild(m),c.appendChild(h),c.onsubmit=t=>{t.preventDefault(),this.validarInstruccion(t.target,{id:i,minimo:a,maximo:o})},r.appendChild(c),UI.crearModal(r)}mostrarModalInstrucciones(){const t=document.createElement("DIV"),{instrucciones:e}=this,n=document.createElement("H2");n.textContent="Instrucciones: ";const i=document.createElement("DIV");if(i.classList.add("seccion","contenedor-instrucciones"),0===e.length){const t=document.createElement("P");t.textContent="No Hay Instrucciones",i.appendChild(t)}else{e.forEach(t=>{const{titulo:e,instruccion:n,minimo:o,maximo:a}=t,r=document.createElement("LI"),c=document.createElement("H4"),s=UI.formatearDescripcion(n),d=document.createElement("P");c.textContent=e+": ",d.textContent=`Instruccion Valida de ${o} a ${a} Puntos`;const l=document.createElement("SPAN");l.classList.add("acciones"),l.innerHTML='\n                    <button type="button" class="boton-naranja" id="actualizar-instruccion">Modificar</button>\n                ',l.onclick=e=>{"actualizar-instruccion"===e.target.id&&this.mostrarModificarinstruccion({...t})},r.appendChild(c),r.appendChild(s),r.appendChild(d),r.appendChild(l),i.appendChild(r)});const t=document.createElement("BUTTON");t.type="button",t.classList.add("boton-rojo"),t.id="eliminar-instruccion",t.textContent="Eliminar",t.onclick=t=>{this.mostrarEliminarinstruccion()},i.lastChild.querySelector(".acciones").appendChild(t)}t.appendChild(n),t.appendChild(i),UI.crearModal(t)}mostrarModalOpciones(){const t=document.createElement("DIV"),e=document.createElement("H2");e.textContent="Opciones: ";const n=document.createElement("DIV");n.classList.add("seccion","contenedor-opciones");const i=document.createElement("P");i.textContent="No Hay Opciones",n.appendChild(i),t.appendChild(e),t.appendChild(n),UI.crearModal(t)}mostrarModalPreguntas(){const t=document.createElement("DIV"),{preguntas:e}=this,n=document.createElement("H2");n.textContent="Preguntas: ";const i=document.createElement("DIV");if(i.classList.add("seccion","contenedor-preguntas"),0===e.length){const t=document.createElement("P");t.textContent="No Hay Preguntas",i.appendChild(t)}else e.forEach((t,e)=>{const{pregunta:n,id:o}=t,a=document.createElement("LI"),r=document.createElement("SPAN"),c=document.createElement("SPAN");r.textContent=`Pregunta ${e+1}: `,c.textContent=n;const s=document.createElement("SPAN");s.classList.add("acciones"),s.innerHTML='\n                    <button type="button" class="boton-naranja" id="actualizar-pregunta">Modificar</button>\n                    <button type="button" class="boton-rojo" id="eliminar-pregunta">Eliminar</button>\n                ',s.onclick=n=>{"actualizar-pregunta"===n.target.id&&this.mostrarModificarPregunta({...t},e+1),"eliminar-pregunta"===n.target.id&&this.mostrarEliminarPregunta(o)},a.appendChild(r),a.appendChild(c),a.appendChild(s),i.appendChild(a)});t.appendChild(n),t.appendChild(i),UI.crearModal(t)}mostrarModificarPregunta(t,e){const{pregunta:n,id:i}=t,o=document.createElement("DIV"),a=document.createElement("FORM");a.classList.add("formulario","formulario-modal");const r=document.createElement("DIV"),c=document.createElement("LABEL"),s=document.createElement("INPUT");r.classList.add("campo"),c.textContent=`Pregunta ${e}: `,c.setAttribute("for","pregunta-modal"),s.placeholder="Nueva Pregunta",s.id="pregunta-modal",s.name="pregunta-modal",s.type="text",s.value=n,r.appendChild(c),r.appendChild(s);const d=document.createElement("BUTTON");d.type="submit",d.textContent="Guardar Cambios",d.classList.add("boton-verde"),a.appendChild(r),a.appendChild(d),a.onsubmit=t=>{t.preventDefault(),this.validarPregunta(t.target,i)},o.appendChild(a),UI.crearModal(o)}mostrarEliminarinstruccion(){Swal.fire({title:"Atencion",text:"¿Deseas Eliminar La instruccion?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(t=>{if(t.isConfirmed){const t=this.eliminarInstruccion(),{minimo:e}=t;datos.minimo=e,this.mostrarModalInstrucciones(),this.cambiarPagina(3),Swal.fire({title:"Exito",text:"La instruccion Ha Sido Eliminada",icon:"success"})}})}mostrarEliminarOpcion(t){Swal.fire({title:"Atencion",text:"¿Deseas Eliminar La Opcion?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(e=>{e.isConfirmed&&(this.eliminarOpcion(t),this.mostrarModalOpciones(),this.cambiarPagina(2),this.validarMaximoInstrucciones(),Swal.fire({title:"Exito",text:"La Opcion Ha Sido Eliminada",icon:"success"}))})}mostrarEliminarPregunta(t){Swal.fire({title:"Atencion",text:"¿Deseas Eliminar La Pregunta?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si",cancelButtonText:"No"}).then(e=>{e.isConfirmed&&(this.eliminarPregunta(t),this.mostrarModalPreguntas(),this.cambiarPagina(2),this.validarMaximoInstrucciones(),Swal.fire({title:"Exito",text:"La Pregunta Ha Sido Eliminada",icon:"success"}))})}validarPregunta(t,e){const n=e?".campo #pregunta-modal":".campo #pregunta",i=t.querySelector(n),o=i.value.trim()??"";if(""===o)return void UI.mostrarAlerta("La Pregunta es Obligatoria",t);if(e){const t={id:e,pregunta:o};return this.modificarPregunta(t),this.mostrarModalPreguntas(),void Swal.fire({title:"Exito",text:"Se Actualizo la Pregunta",icon:"success"})}const a={id:Date.now(),pregunta:o};this.agregarPregunta(a),i.value="",i.previousElementSibling.textContent="Pregunta: "+(this.preguntas.length+1),UI.mostrarAlerta("La Pregunta se Agrego Corretamente",t,"exito")}validarInstruccion(t,e={}){const{id:n}=e,{minimo:i,maximo:o}=datos,a=t.querySelector(".campo #maximo"),r=n?e.maximo:a.value.trim(),c=t.querySelector(n?".campo #titulo-modal":".campo #titulo").value.trim(),s=t.querySelector(n?".campo #instruccion-modal":".campo #instruccion").value.trim();if(""===r||""===c||""===s)return void UI.mostrarAlerta("Todos Los campos son Obligatorios",t);if(n){const{minimo:t}=e,i={id:n,titulo:c,instruccion:s,maximo:r,minimo:t};return this.modificarInstruccion(i),this.mostrarModalInstrucciones(),void Swal.fire({title:"Exito",text:"Se Actualizo la instruccion",icon:"success"})}if(isNaN(r)||r>o||r<i)return void UI.mostrarAlerta("Datos Invalidos",t);const d={id:Date.now(),titulo:c,instruccion:s,minimo:i,maximo:r};this.agregarInstruccion(d),datos.minimo=parseInt(r)+1,mostrarFormulario()}}