import UI from"../../../layout/UI.js";import TiposCampos from"../../db/TiposCampos.js";import{test,visita}from"./funcionesTestEdu.js";export default class EduTest{mostrarCamposExtra(e){const{campos:t}=test,a=document.createElement("DIV");a.classList.add("contenedor-campos"),t.forEach(e=>{const{id:t,type:o,nombre:n}=e,r=TiposCampos.filter(e=>e.type===o)[0],i=document.createElement("DIV");i.classList.add("campo");const s={id:Math.round(Math.random()*Date.now()),name:t,type:o,pregunta:n,valor:""};if(1===r.id||2===r.id){const{atributos:{placeholder:a},atributos:c}=e,d=document.createElement("LABEL");d.textContent=n,d.setAttribute("for",t);const p=document.createElement("INPUT");if(p.placeholder=a,p.name=t,p.id=t,p.type=o,p.oninput=e=>{this.validarCampoExtra(e.target.parentElement,e.target.value.trim(),t)},2===r.id){const{entero:e,maximo:t,minimo:a}=c;s.entero=e,p.step=e?1:"any",(0==t||t)&&(p.max=t,s.maximo=t),(0==t||a)&&(p.min=a,s.minimo=a)}i.appendChild(d),i.appendChild(p)}if(3===r.id||4===r.id){const e=document.createElement("LABEL");e.textContent=n,e.setAttribute("for",t);const a=document.createElement("INPUT");a.name=t,a.id=t,a.type=o,a.oninput=e=>{this.validarCampoExtra(e.target.parentElement,e.target.value.trim(),t)},i.appendChild(e),i.appendChild(a)}if(5===r.id||6===r.id){i.className="campo-radio";const{opciones:a}=e;s.opciones=[];const c=document.createElement("P");c.textContent=n,c.dataset.for=t;const d=document.createElement("DIV");d.classList.add("campo-multiple","opciones-test"),d.dataset.id=t,a.forEach(e=>{const{id:a,opcion:n,valor:i}=e,c=document.createElement("DIV");c.classList.add("radio");const p=document.createElement("LABEL"),m=document.createElement("INPUT");p.textContent=n,p.setAttribute("for",a),m.name=t,m.id=a,m.type=o,m.oninput=e=>{this.validarCampoExtra(e.target.parentElement.parentElement.parentElement,i,t,a,e.target.checked)},c.appendChild(m),c.appendChild(p),d.appendChild(c);const l={id:a,opcion:n,valor:i};5===r.id&&(l.checked=!1),s.opciones=[...s.opciones,l]}),i.appendChild(c),i.appendChild(d),5===r.id&&(s.valor=[])}a.appendChild(i),visita.agregarCampoExtra(s)}),e.appendChild(a)}validarCampoExtra(e,t,a,o,n){const{camposExtra:r}=visita,[i]=r.filter(e=>parseInt(e.name)===parseInt(a));if(""===t)return void UI.mostrarAlerta("El Campo es Obligatorio",e,!1);if("number"===i.type){const{entero:a,minimo:o,maximo:n}=i;if(a&&!Number.isInteger(Number(t)))return void UI.mostrarAlerta("El Valor Es Invalido",e,!1);if(o&&n&&(Number(t)<o||Number(t)>n))return void UI.mostrarAlerta("Numero Invalido",e,!1)}if("date"===i.type&&isNaN(Date.parse(t)))return void UI.mostrarAlerta("Fecha Invalida",e,!1);const s=e.querySelector(".alerta");s&&s.remove(),this.obtenerDatosCampoExtra(t,{...i},o,n)}obtenerDatosCampoExtra(e,t,a,o){const{type:n}=t;if("checkbox"!==n)return t.valor=e,void visita.modificarCampoExtra(t);const[r]=t.opciones.filter(e=>parseInt(e.id)===parseInt(a));r.checked=o,t.opciones=t.opciones.map(e=>parseInt(e.id)===a?r:e);const{opciones:i}=t,s=i.filter(e=>e.checked);t.valor=s.map(e=>e.valor),visita.modificarCampoExtra(t)}sincronizarCampos(e,t,a){const[{...o}]=visita.campos.filter(t=>parseInt(e)===parseInt(t.name)),{multiple:n}=o,[r]=o.opciones.filter(e=>parseInt(t)===e.id);if(!n)return o.valor=r,void visita.modificarCampo(o);r.checked=a,o.opciones=o.opciones.map(e=>parseInt(e.id)===parseInt(t)?r:e);const i=o.opciones.filter(e=>e.checked);o.valor=i,visita.modificarCampo(o)}mostrarAlertasCampos(e,t){e.forEach(e=>{const{opciones:a,name:o}=e;if(a){const e=t.querySelector(`p[data-for='${o}']`).parentElement;return void UI.mostrarAlerta("El Campo es Obligatorio",e)}const n=t.querySelector(`label[for="${o}"]`).parentElement;UI.mostrarAlerta("El Campo es Obligatorio",n)})}mostrarInformacionTest(e){const t=e.parentElement;e.remove();const{puntuacion:a,instruccion:o,total:n}=visita,{titulo:r,instruccion:i}=o,s=document.createElement("DIV");s.classList.add("contenedor-test-edu");const c=document.createElement("DIV");c.classList.add("contenedor-puntos");const d=document.createElement("P");d.textContent=`Tuviste ${a} de ${n} puntos`,d.classList.add("Puntaje"),c.appendChild(d);const p=document.createElement("DIV");p.classList.add("contenedor-instruccion");const m=document.createElement("H3");m.textContent=r;const l=UI.formatearDescripcion(i);p.appendChild(m),p.appendChild(l);const u=document.createElement("DIV");u.classList.add("acciones");const E=document.createElement("A");E.classList.add("boton-verde-oscuro"),E.textContent="Ver Reporte",E.href="/pdf/visita?id="+visita.id,E.target="_blank";const C=document.createElement("A");C.classList.add("boton-secundario"),C.textContent="Descargar Reporte",C.href="/pdf/visita?id="+visita.id,C.download=test.nombre.replaceAll(" ","_").replaceAll(".","_")+".pdf",u.appendChild(E),u.appendChild(C),s.appendChild(c),s.appendChild(p),s.appendChild(u),t.appendChild(s)}}