import CrearTest from"./crearTest.js";import{cambiarPagina,mostrarFormulario,test}from"./funcionesTestCrear.js";import UI from"../../../layout/UI.js";export default class CrearTestAvanzado extends CrearTest{formulario2(e){const t=test.preguntas.length+1,n=document.createElement("DIV");n.classList.add("campo-pregunta-opcion","seccion");const o=document.createElement("DIV"),a=document.createElement("LABEL"),i=document.createElement("INPUT");o.classList.add("campo"),a.textContent=`Pregunta del Campo ${t}: `,a.setAttribute("for","pregunta"),i.placeholder="Pregunta del Campo",i.id="pregunta",i.name="pregunta",i.type="text",o.appendChild(a),o.appendChild(i);const r=document.createElement("DIV"),c=document.createElement("LABEL"),l=document.createElement("INPUT");r.classList.add("campo"),c.textContent="Opciones Multiples: ",c.setAttribute("for","multiple"),l.type="checkbox",l.name="multiple",l.id="multiple",r.appendChild(c),r.appendChild(l);const d=document.createElement("DIV"),p=document.createElement("LABEL"),s=document.createElement("INPUT");d.classList.add("campo"),p.textContent="Numero de Opciones: ",p.setAttribute("for","num-opciones"),s.placeholder="Numero de Opciones Para Este Campo",s.type="number",s.id="num-opciones",s.name="num-opciones",s.min=2,s.max=10,s.oninput=e=>{this.validarNumOpciones(e.target.parentElement,e.target.value.trim())},d.appendChild(p),d.appendChild(s),n.appendChild(o),n.appendChild(r),n.appendChild(d),e.appendChild(n)}mostrarModificarOpcion(e,t,n){const{id:o,opciones:a,multiple:i}=e,r=document.createElement("DIV"),c=document.createElement("FORM");c.classList.add("formulario","formulario-modal");const l=document.createElement("P");l.textContent=t,l.classList.add("pregunta-opcion"),c.appendChild(l);const d=document.createElement("DIV"),p=document.createElement("LABEL"),s=document.createElement("INPUT");d.classList.add("campo"),p.textContent="Opciones Multiples: ",p.setAttribute("for","multiple-modal"),s.type="checkbox",s.name="multiple-modal",s.id="multiple-modal",s.checked=i,d.appendChild(p),d.appendChild(s),c.appendChild(d);const m=document.createElement("BUTTON");m.type="button",m.textContent="Cambiar Numero de opciones",m.classList.add("boton-naranja"),m.onclick=n=>{this.mostrarCambiarNumInp(e,t)},n&&(e={id:o,multiple:i,opciones:[]}),this.mostrarInputsOpciones(c,n||a.length,e),c.appendChild(m),r.appendChild(c),UI.crearModal(r)}mostrarCambiarNumInp(e,t){const{opciones:n}=e,o=document.createElement("DIV"),a=document.createElement("FORM");a.classList.add("formulario","formulario-modal");const i=document.createElement("P");i.textContent=t,i.classList.add("pregunta-opcion"),a.appendChild(i);const r=document.createElement("DIV"),c=document.createElement("LABEL"),l=document.createElement("INPUT");r.classList.add("campo"),c.textContent="Numero de Opciones: ",c.setAttribute("for","num-opciones"),l.placeholder="Numero de Opciones Para Este Campo",l.type="number",l.id="num-opciones",l.name="num-opciones",l.min=2,l.max=10,l.value=n.length,r.appendChild(c),r.appendChild(l);const d=document.createElement("BUTTON");d.type="submit",d.classList.add("boton-naranja"),d.textContent="Cambiar";const p=document.createElement("BUTTON");p.type="button",p.classList.add("boton-rojo"),p.textContent="Cancelar",p.onclick=()=>{this.mostrarModificarOpcion(e,t)},a.onsubmit=n=>{n.preventDefault(),this.validarNumOpciones(a,l.value,e,t)},a.appendChild(r),a.appendChild(d),a.appendChild(p),o.appendChild(a),UI.crearModal(o)}mostrarModalOpciones(){const{opciones:e,preguntas:t}=test,n=document.createElement("DIV"),o=document.createElement("H2");o.textContent="Opciones: ";const a=document.createElement("DIV");if(a.classList.add("seccion","contenedor-opciones"),0===e.length){const e=document.createElement("P");e.textContent="No Hay Opciones",a.appendChild(e)}else e.forEach(e=>{const{id:n,opciones:o,multiple:i}=e,r=t.filter(e=>parseInt(e.id)===parseInt(n));if(1===r.length){const[{pregunta:t}]=r,c=document.createElement("DIV"),l=document.createElement("H4");l.textContent=t;const d=document.createElement("P");d.textContent=i?"Opciones Multiples":"Opciones Basicas",c.appendChild(l),c.appendChild(d),o.forEach(({opcion:e,valor:t},n)=>{const o=document.createElement("LI"),a=document.createElement("SPAN"),i=document.createElement("SPAN"),r=document.createElement("P");a.textContent=`Opcion ${n+1}: `,i.textContent=e,r.textContent="Valor: "+t,o.appendChild(a),o.appendChild(i),o.appendChild(r),c.appendChild(o)});const p=document.createElement("SPAN");p.classList.add("acciones"),p.innerHTML='\n                    <button type="button" class="boton-naranja" id="actualizar-opcion">Modificar</button>\n                    <button type="button" class="boton-rojo" id="eliminar-opcion">Eliminar</button>\n                ',p.onclick=o=>{"actualizar-opcion"===o.target.id&&this.mostrarModificarOpcion({...e},t),"eliminar-opcion"===o.target.id&&this.mostrarEliminarOpcion(n)},c.appendChild(p),a.appendChild(c)}});n.appendChild(o),n.appendChild(a),UI.crearModal(n)}mostrarInputsOpciones(e,t,n={}){const{id:o,opciones:a}=n,i=document.createElement("DIV");i.classList.add("campo-opciones","seccion");for(let e=1;e<=t;e++){let t,n;a&&a.length>=1&&(t=a[e-1].opcion,n=a[e-1].valor);const r=document.createElement("DIV"),c=document.createElement("LABEL"),l=document.createElement("INPUT");r.classList.add("campo"),c.setAttribute("for","opcion-"+e),c.textContent=`Opcion ${e}: `,l.type="text",l.name="opcion-"+e,l.id="opcion-"+e,l.classList.add(o?"opcion-input-modal":"opcion-input"),l.placeholder="Nueva Opcion",l.value=t??"",r.appendChild(c),r.appendChild(l);const d=document.createElement("DIV"),p=document.createElement("LABEL"),s=document.createElement("INPUT");d.classList.add("campo"),p.setAttribute("for","valor-"+e),p.textContent="Valor: ",s.name="valor-"+e,s.id="valor-"+e,s.placeholder="Valor de la Opcion",s.classList.add(o?"valor-input-modal":"valor-input"),s.type="number",s.min=1,s.max=10,s.value=n??"",d.appendChild(p),d.appendChild(s),i.appendChild(r),i.appendChild(d)}const r=document.createElement("BUTTON");r.type="button",r.textContent=o?"Guardar Cambios":"Agregar Campo",r.classList.add("boton-verde","agregar-campo"),r.onclick=e=>{this.validarCampo(e.target.parentElement,t,o)},e.onsubmit=e=>e.preventDefault(),e.appendChild(i),e.appendChild(r)}validarCampo(e,t,n){const o=e.querySelector(".campo #pregunta"),a=o?o.value.trim():"",i=e.querySelector(n?".campo #multiple-modal":".campo #multiple").checked??!1,r=e.querySelectorAll(n?".campo .opcion-input-modal":".campo .opcion-input"),c=e.querySelectorAll(n?".campo .valor-input-modal":".campo .valor-input");let l=[],d=[];if(r.forEach(e=>l=[...l,e.value.trim()]),c.forEach(e=>d=[...d,e.value.trim()]),!n){if(""===a)return void UI.mostrarAlerta("La Pregunta Es Obligatoria",e);if(parseInt(t)!==r.length||parseInt(t)!==c.length)return void UI.mostrarAlerta("Las Opciones NO Coinciden Con El Valor Dado",e)}const p=l.filter(e=>""===e),s=d.filter(e=>""===e||isNaN(e)||e>10||e<1);if(0!==p.length||0!==s.length)return void UI.mostrarAlerta("Todos los campos Son Obligatorios o Invalidos",e);const m=Math.round(Math.random()*Date.now()),u={id:m,multiple:i,opciones:[]};for(let e=0;e<l.length;e++){const t=l[e],n=d[e],o={id:Math.round(Math.random()*Date.now()),opcion:t,valor:n};u.opciones=[...u.opciones,o]}if(n)return u.id=n,test.modificarOpcion(u),cambiarPagina(2),this.mostrarModalOpciones(),this.validarMaximoInstrucciones(),void Swal.fire({title:"Exito",text:"Se Actualizo la Opcion",icon:"success"});const C={id:m,pregunta:a};test.agregarPregunta(C),test.agregarOpcion(u),mostrarFormulario(),Swal.fire({title:"Exito",text:"Se Creo el Campo",icon:"success"})}validarNumOpciones(e,t,n,o){if(!n){const t=e.parentElement.querySelector(".campo-opciones"),n=e.parentElement.querySelector(".agregar-campo");t&&t.remove(),n&&n.remove()}if(""===t)return void UI.mostrarAlerta("El Numero Es Obligatorio",e);if(isNaN(t)||t>10||t<2)return void UI.mostrarAlerta("Solo Se Pueden Agregar de 2 a 10 Opciones",e);if(n)return void this.mostrarModificarOpcion(n,o,t);const a=e.querySelector(".alerta");a&&a.remove(),this.mostrarInputsOpciones(e.parentElement,t)}}